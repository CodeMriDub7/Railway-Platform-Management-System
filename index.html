<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>StationMaster Pro | Ultimate UX</title>
    <style>
        :root {
            --bg-glass: rgba(255, 255, 255, 0.9);
            --card-glass: rgba(255, 255, 255, 0.8);
            --primary: #2563eb;
            --accent: #059669;
            --text: #0f172a;
            --track: #334155;
        }

        /* Moving Background */
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text);
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* Table Styling */
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { padding: 12px; text-align: left; color: var(--primary); font-weight: 600; text-transform: uppercase; font-size: 12px; }
        td { background: white; padding: 10px; border: 1px solid #e2e8f0; }
        td:first-child { border-radius: 12px 0 0 12px; }
        td:last-child { border-radius: 0 12px 12px 0; }
        
        input, select { border: none; outline: none; width: 100%; padding: 5px; font-size: 14px; }

        .btn-row { display: flex; gap: 10px; margin: 20px 0; }
        button { flex: 1; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .add-btn { background: var(--accent); color: white; }
        .calc-btn { background: var(--primary); color: white; }

        /* Contained Train Animation */
        #loading-tunnel { 
            display: none; 
            background: #cbd5e1; 
            border-radius: 15px; 
            height: 80px; 
            position: relative; 
            overflow: hidden; 
            margin: 20px 0;
            border: 4px solid #94a3b8;
        }
        .rail { position: absolute; width: 100%; height: 4px; background: #64748b; bottom: 15px; }
        .train-group {
            position: absolute; bottom: 15px; left: -900px; 
            display: flex; align-items: flex-end;
            animation: drive-contained 4s linear infinite;
        }
        .c-coach { width: 70px; height: 35px; background: var(--primary); margin-right: 3px; border-radius: 3px; flex-shrink: 0; }
        .c-engine { width: 90px; height: 45px; background: #1e293b; border-radius: 3px 25px 3px 3px; flex-shrink: 0; }
        
        @keyframes drive-contained {
            0% { left: -900px; }
            100% { left: 100%; }
        }

        /* COLUMNAR RESULTS GRID */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .train-card {
            background: var(--card-glass);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            border-top: 6px solid var(--primary);
        }
        .train-card:hover { transform: translateY(-5px); }
        .priority-high { border-top-color: #ef4444; }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .pf-tag { background: var(--primary); color: white; padding: 4px 12px; border-radius: 50px; font-weight: bold; font-size: 14px; }
        
        .info-row { margin-bottom: 10px; font-size: 13px; color: #475569; }
        .info-label { font-weight: bold; color: var(--text); display: block; margin-bottom: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üöâ StationMaster <span style="color:var(--primary)">Pro</span></h1>
        <p style="font-size: 12px; opacity: 0.7;">Intelligent Platform Management</p>
    </div>

    <table id="trainTable">
        <thead>
            <tr>
                <th>Train No.</th>
                <th>Priority</th>
                <th>Arrival Date/Time</th>
                <th>Departure Date/Time</th>
                <th>Type</th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="btn-row">
        <button class="add-btn" onclick="addRow()">+ Add New Entry</button>
        <button class="calc-btn" onclick="processSchedule()">Execute Simulation</button>
    </div>

    <div id="loading-tunnel">
        <div class="rail"></div>
        <div class="train-group">
            <div class="c-coach"></div><div class="c-coach"></div><div class="c-coach"></div>
            <div class="c-coach"></div><div class="c-coach"></div><div class="c-coach"></div>
            <div class="c-engine"></div>
        </div>
    </div>

    <div id="total-banner" style="display:none; text-align:center; padding:15px; background:var(--primary); color:white; border-radius:12px; margin:20px 0;">
        <h2 style="margin:0;">Required Platforms: <span id="pf-total">0</span></h2>
    </div>

    <div id="results" class="results-grid"></div>
</div>

<script>
    window.onload = () => addRow();

    function addRow() {
        const tbody = document.querySelector("#trainTable tbody");
        const row = document.createElement("tr");
        row.innerHTML = `
            <td><input type="text" class="tNo" placeholder="12675"></td>
            <td>
                <select class="prio">
                    <option value="10">High (Express)</option>
                    <option value="5">Medium (Superfast)</option>
                    <option value="1" selected>Standard (Local)</option>
                </select>
            </td>
            <td><input type="datetime-local" class="arr"></td>
            <td><input type="datetime-local" class="dep"></td>
            <td>
                <select class="type">
                    <option value="U">Upstream</option>
                    <option value="D">Downstream</option>
                    <option value="R">Reversal</option>
                </select>
            </td>
            <td><button onclick="this.parentElement.parentElement.remove()" style="background:none; border:none; color:red; cursor:pointer;">‚úñ</button></td>
        `;
        tbody.appendChild(row);
    }

    async function processSchedule() {
        const rows = document.querySelectorAll("tbody tr");
        const trains = Array.from(rows).map(r => ({
            trainNo: r.querySelector(".tNo").value || "N/A",
            priority: parseInt(r.querySelector(".prio").value),
            arrival: r.querySelector(".arr").value,
            departure: r.querySelector(".dep").value,
            type: r.querySelector(".type").value
        })).filter(t => t.arrival && t.departure);

        if (trains.length === 0) return alert("Please input train schedules.");

        document.getElementById("loading-tunnel").style.display = "block";
        document.getElementById("results").innerHTML = "";

        try {
            const res = await fetch('http://localhost:3000/calculate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ trains })
            });
            const data = await res.json();
            
            setTimeout(() => {
                document.getElementById("loading-tunnel").style.display = "none";
                render(data.results);
            }, 3000);
        } catch (e) { alert("Server Connection Lost!"); }
    }

    function render(res) {
        document.getElementById("total-banner").style.display = "block";
        document.getElementById("pf-total").innerText = res.total;
        
        const grid = document.getElementById("results");
        grid.innerHTML = res.schedule.map(t => {
            const arrDate = new Date(t.arrival);
            const depDate = new Date(t.departure);
            
            return `
                <div class="train-card ${t.priority === 10 ? 'priority-high' : ''}">
                    <div class="card-header">
                        <span style="font-weight:900; font-size:18px;"># ${t.trainNo}</span>
                        <span class="pf-tag">Platform ${t.platform}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">üìÖ Arrival</span>
                        ${arrDate.toLocaleDateString()} | ${arrDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                    </div>
                    <div class="info-row">
                        <span class="info-label">üìÖ Departure</span>
                        ${depDate.toLocaleDateString()} | ${depDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                    </div>
                    <div class="info-row">
                        <span class="info-label">üõ§Ô∏è Movement Type</span>
                        ${t.type === 'R' ? 'Reversal (Long Stay)' : 'Through Train'}
                    </div>
                </div>
            `;
        }).join('');
    }
</script>
</body>
</html>
