<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Platform Calculator | Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { 
            --bg-color: #f8f9fa; --text-color: #2c3e50; --container-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.08); --header-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea; --success-color: #48bb78; --danger-color: #f56565;
            --border-color: #e2e8f0; --input-bg: #f7fafc; --hover-bg: #edf2f7;
        }
        body.dark-mode {
            --bg-color: #0f172a; --text-color: #e2e8f0; --container-bg: #1e293b;
            --input-bg: #0f172a; --hover-bg: #334155; --border-color: #334155;
        }
        body {
            font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color);
            color: var(--text-color); padding: 20px; min-height: 100vh;
            display: flex; justify-content: center; transition: 0.4s;
        }
        .main-wrapper { width: 100%; max-width: 900px; }
        .container { 
            background: var(--container-bg); padding: 30px; border-radius: 16px; 
            box-shadow: 0 10px 40px var(--shadow); margin-top: 40px; 
        }
        .header { text-align: center; margin-bottom: 25px; }
        #theme-toggle { position: fixed; top: 20px; right: 20px; padding: 10px 20px; border-radius: 25px; cursor: pointer; background: var(--primary-color); color: white; border: none; }
        
        /* Table Styles */
        .table-wrapper { overflow-x: auto; margin-top: 20px; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--header-bg); color: white; padding: 12px; font-size: 13px; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid var(--border-color); }
        input, select { width: 100%; padding: 8px; border: 1.5px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-color); }

        /* Results Styling */
        #result-box { margin-top: 30px; }
        .summary-stats { 
            display: flex; justify-content: space-around; background: var(--header-bg); 
            color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; 
        }
        .results-container { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; 
        }
        .platform-card { 
            background: var(--container-bg); border: 2px solid var(--primary-color); 
            padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 4px 10px var(--shadow);
        }
        .plat-num { font-size: 24px; font-weight: bold; color: var(--primary-color); display: block; }
        .train-tag { font-size: 12px; background: var(--hover-bg); padding: 3px 8px; border-radius: 10px; }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { padding: 12px 20px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; }
        .btn-add { background: var(--success-color); color: white; }
        .btn-calc { background: var(--primary-color); color: white; flex-grow: 1; }
    </style>
</head>
<body>

<button id="theme-toggle" onclick="document.body.classList.toggle('dark-mode')">üåì Toggle Theme</button>

<div class="main-wrapper">
    <div class="container">
        <div class="header">
            <h2>üöâ Railway Platform Planner</h2>
            <p class="subtitle">Enter day-wise schedules to calculate platforms & assignments</p>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Train No</th>
                        <th>Direction</th>
                        <th>Arrival (Date & Time)</th>
                        <th>Departure (Date & Time)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="train-table-body">
                    <tr class="train-row">
                        <td><input type="text" class="t-no" placeholder="12401"></td>
                        <td>
                            <select class="t-dir">
                                <option value="Up">Upstream</option>
                                <option value="Down">Downstream</option>
                            </select>
                        </td>
                        <td><input type="datetime-local" class="t-arr"></td>
                        <td><input type="datetime-local" class="t-dep"></td>
                        <td><button class="delete-btn" onclick="this.parentElement.parentElement.remove()">‚ùå</button></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="btn-group">
            <button class="btn-add" onclick="addRow()">+ Add Train</button>
            <button class="btn-calc" onclick="calculate()">Calculate Requirements</button>
        </div>

        <div id="result-box"></div>
    </div>
</div>

<script>
    function addRow() {
        const row = `<tr class="train-row">
            <td><input type="text" class="t-no"></td>
            <td><select class="t-dir"><option value="Up">Upstream</option><option value="Down">Downstream</option></select></td>
            <td><input type="datetime-local" class="t-arr"></td>
            <td><input type="datetime-local" class="t-dep"></td>
            <td><button class="delete-btn" onclick="this.parentElement.parentElement.remove()">‚ùå</button></td>
        </tr>`;
        document.getElementById('train-table-body').insertAdjacentHTML('beforeend', row);
    }

    async function calculate() {
        const rows = document.querySelectorAll('.train-row');
        const trains = Array.from(rows).map(r => ({
            trainNo: r.querySelector('.t-no').value,
            direction: r.querySelector('.t-dir').value,
            arrival: r.querySelector('.t-arr').value,
            departure: r.querySelector('.t-dep').value
        }));

        const res = await fetch('http://localhost:3000/calculate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ trains })
        });

        const data = await res.json();
        if (data.success) renderResults(data.results);
    }

    function renderResults(res) {
        const box = document.getElementById('result-box');
        let html = `
            <div class="summary-stats">
                <div><h4>Upstream</h4><p>${res.upstreamCount}</p></div>
                <div><h4>Downstream</h4><p>${res.downstreamCount}</p></div>
                <div><h4>Total</h4><p>${res.totalPlatforms}</p></div>
            </div>
            <div class="results-container">`;
        
        res.assignments.forEach(a => {
            html += `
                <div class="platform-card">
                    <span class="plat-num">P${a.platformNo}</span>
                    <span class="train-tag">Train ${a.trainNo}</span>
                </div>`;
        });
        box.innerHTML = html + `</div>`;
    }
</script>
</body>
</html>
